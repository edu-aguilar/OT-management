<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../styles/shared-styles.html">
<link rel="import" href="../../bower_components/ability-chart/ability-chart.html">
<link rel="import" href="../components/user-item.html">

<dom-module id="detail-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
    </style>

    <div class="card">

      <user-item data="[[person]]"></user-item>

      <ability-chart
        prop="[[chartProperties]]">
      </ability-chart>

    </div>
  </template>

  <script>
    class detailView extends (class extends Polymer.Element {}) {
      
      static get is() { return 'detail-view'; }

      static get properties() {
        return {
          person: {
            type: Object,
            observer: '_onUserLoaded',
            value: () => ({})
          },
          chartProperties: {
            type: Object,
            value: {
              "dimension": 500,
              "numLayer": 3,
              "eachLayerStyle": [
                {
                  "fillColor": "#54ffac",
                  "borderColor": "#bbbbbb"
                },
                {
                  "fillColor": "#fcb853",
                  "borderColor": "#bbbbbb"
                },
                {
                  "fillColor": "#ff5959",
                  "borderColor": "#bbbbbb"
                }
              ],
              "labelFont": "13px Arial",
              "labelFontColor": "#7a7a7a",
              "labelOffset": 10,
              "frameBorderWidth": 1,
              "chartBorderWidth": 2,
              "decorLineColor": "#bbbbbb",
              "chartPortion": 0.75,
              "chartAlpha": 0.95,
              "scale": {
                "font": "bold 12px Arial",
                "fontColor": "black",
                "offset": 12,
                "scaleLabel": ["0", "33", "66", "99"]
              },
              "datasets": {
                "keys": [],
                "values": [],
                "styles": [
                  { "borderColor": "#334b5c" },
                  { "borderColor": "#d53c37" }
                ]
              }
            }
          }
        }
      }

      /**
       * Use for one-time configuration of your component after local DOM is initialized. 
       */
      ready() {
        super.ready();

        Polymer.RenderStatus.afterNextRender(this, function () {

        });
      }

      _onUserLoaded(user) {
        if (!!Object.keys(user).length) {
          this.set('chartProperties.datasets.keys', this.person.skills.technical.keys);
          this.set('chartProperties.datasets.values', this.person.skills.technical.values);
          this.shadowRoot.querySelector('ability-chart').buildChart();
        }
      }

    }

    window.customElements.define(detailView.is, detailView);
  </script>
</dom-module>
